# Бизнес требования

- Юзер должен иметь возможность зарегистрироваться и залогиниться.
- Публиковать фразы с тегами.
- Получать свои фразы.

# Функциональные требования

## 1.1 Метод registration POST

**Входящие данные**

```json
{
  "authorization": {
    "nickname": "login_example",
    "password": "password_example"
  }
}
```

**Валидация**<br/>
nickname >= 4 символа, <= 15 символов, разрешенные символы a-zA-Z0-9а-яА-Я. _-<br/>
password >= 8 символов, <= 100 символов, разрешенные символы a-zA-Z0-9а-яА-Я.,:; _?!+=/'\"*(){}[]-

**Логика метода**<br/>
Cервис совершает поиск входящего nickname в таблице user, если находит - возвращает ошибку NICKNAME_TAKEN,
иначе генерирует accessToken. Шифрует входящий password, записывает в таблицу user nickname, password, accessToken.
Возвращает клиенту accessToken.

**Исходящие данные в случае успеха** <br/>статус 200

```json
{
  "data": {
    "accessToken": "d4a76068f5104f26975499d22bcd11cc1665995491673"
  }
}
```

**Исходящие данные в случае ошибки**<br/>статус 400

```json
{
  "error": {
    "code": "REQUEST_VALIDATION_ERROR",
    "userMessage": "Некорректный nickname. Некорректный password."
  }
}
```

```json
{
  "error": {
    "code": "NICKNAME_BUSY",
    "userMessage": "Этот ник уже занят, придумайте другой."
  }
}
```

## 1.2 Метод login POST

**Входящие данные**

```json
{
  "authorization": {
    "nickname": "barabashka",
    "password": "barabashka1980"
  }
}
```

**Валидация**<br/>
nickname >= 4 символа, <= 15 символов, разрешенные символы a-zA-Z0-9а-яА-Я. _-<br/>
password >= 8 символов, <= 100 символов, разрешенные символы a-zA-Z0-9а-яА-Я.,:; _?!+=/'\"*(){}[]-

**Логика метода**<br/>
Сервис шифрует password таким же образом, как и метод registration в пункте 1.1. Совершает поиск в таблице user по
столбцам
nickname и password, если находит - возвращает accessToken, иначе возвращает ошибку USER_NOT_FOUND.

**Исходящие данные в случае успеха** <br/>статус 200

```json
{
  "data": {
    "accessToken": "d4a76068f5104f26975499d22bcd11cc1665995491673"
  }
}
```

**Исходящие данные в случае ошибки**<br/>статус 400

```json
{
  "error": {
    "code": "REQUEST_VALIDATION_ERROR",
    "techMessage": "Некорректный nickname. Некорректный password."
  }
}
```

```json
{
  "error": {
    "code": "USER_NOT_FOUND",
    "userMessage": "Пользователь не найден."
  }
}
```

## 2 Метод publish-phrase (auth) POST

**Входящие данные**<br/>

```json
{
  "text": "Сегодня солнечный день",
  "tags": [
    "погода",
    "солнце",
    "хорошее настроение"
  ]
}
```

**Валидация**<br/>
text >= 1 символов, <= 140, разрешенные символы a-zA-Z0-9а-яА-Я.,:; _?!+=/'\"*(){}[]-<br/>
tags от 0 до 5, значение от >= 3 символов, <= 25, разрешенные символы a-zA-Z0-9а-яА-Я.,:; _?!+=/'\"*(){}[]-

**Логика метода**<br/>
Сервис проверяет наличие accessToken в таблице user столбце access_token, если не находит - возвращает ошибку
AUTHORIZATION_ERROR, иначе получает id юзера по accessToken.
Записывает фразу в таблицу phrase, по каждому тегу проверяет есть ли в таблице tag такой тег, если нет - записывает.
Получает id всех тегов, записывает id фразы и тегов в таблицу phrase_tag.

**Исходящие данные в случае успеха** <br/>статус 200

**Исходящие данные в случае ошибки**<br/>статус 400
```json
{
  "error": {
    "code": "AUTHORIZATION_ERROR",
    "userMessage": "Ошибка авторизации"
  }
}
```

## 3 Метод my-phrases (auth) GET

**Входящие данные**<br/>
`AccessToken: 8e043390d24642a9ae64e303568c27d61666011676410`

**Логика метода**<br/>
Сервис получает фразы юзера по его id, получает теги к каждой фразе по её id, упорядочивает по времени от новым к старым
и отсылает юзеру.

**Исходящие данные в случае успеха** <br/>статус 200

```json
{
  "data": {
    "phrases": [
      {
        "phraseId": 9,
        "nickname": "barabashka",
        "text": "Сегодня солнечный день",
        "timeInsert": "2023-01-03 16:12:15",
        "tags": [
          {
            "tagId": 1,
            "text": "погода"
          },
          {
            "tagId": 2,
            "text": "день"
          }
        ],
        "countLikes": 0,
        "comments": [
          {
            "userId": 9,
            "nickname": "арбузо",
            "commentId": 6,
            "text": "вот это великая фраза!",
            "timeInsert": "2022-12-13 14:52:22"
          }
        ]
      },
      {
        "phraseId": 8,
        "userId":9,
        "nickname": "арбузо",
        "text": "Сегодня солнечный день - 2",
        "timeInsert": "2023-01-03 16:09:15",
        "tags": [
          {
            "tagId": 1,
            "text": "погода"
          },
          {
            "tagId": 3,
            "text": "солнце"
          },
          {
            "tagId": 1,
            "text": "хороший день"
          }
        ],
        "countLikes": 2,
        "comments": [
          {
            "userId": 1,
            "nickname": "barabashka",
            "commentId": 1,
            "text": "В моем городе тоже отличная погода.",
            "timeInsert": "2023-01-17 11:41:57"
          }
        ]
      }
    ]
  }
}
```
